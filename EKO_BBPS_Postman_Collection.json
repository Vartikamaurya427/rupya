{
	"info": {
		"name": "EKO BBPS API Collection",
		"description": "Complete Postman collection for EKO BBPS integration testing with automatic authentication headers",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// EKO BBPS Authentication - Pre-request Script",
					"// Generates secret-key and secret-key-timestamp for every request",
					"",
					"// Get authenticator key from collection variables",
					"const authenticatorKey = pm.collectionVariables.get('authenticator_key');",
					"const developerKey = pm.collectionVariables.get('developer_key');",
					"",
					"if (!authenticatorKey || !developerKey) {",
					"    console.warn('⚠️ Warning: authenticator_key or developer_key not set in collection variables');",
					"    console.warn('Please set these variables in Collection > Variables');",
					"}",
					"",
					"// Step 1: Base64 encode AUTHENTICATOR_KEY",
					"const encodedKey = CryptoJS.enc.Base64.stringify(CryptoJS.enc.Utf8.parse(authenticatorKey));",
					"",
					"// Step 2: Generate current timestamp in milliseconds",
					"const timestamp = Date.now().toString();",
					"",
					"// Step 3: Generate HMAC SHA256 signature",
					"// Message: timestamp",
					"// Key: base64EncodedAuthenticatorKey",
					"const signature = CryptoJS.HmacSHA256(timestamp, encodedKey);",
					"",
					"// Step 4: Base64 encode the signature → secret-key",
					"const secretKey = CryptoJS.enc.Base64.stringify(signature);",
					"",
					"// Set collection variables for use in headers",
					"pm.collectionVariables.set('secret-key', secretKey);",
					"pm.collectionVariables.set('secret-key-timestamp', timestamp);",
					"",
					"console.log('✅ EKO Auth Headers Generated');",
					"console.log('Timestamp:', timestamp);"
				]
			}
		}
	],
	"item": [
		{
			"name": "Operator APIs (Public)",
			"item": [
				{
					"name": "Get Operator Categories",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "developer_key",
								"value": "{{developer_key}}"
							},
							{
								"key": "secret-key",
								"value": "{{secret-key}}"
							},
							{
								"key": "secret-key-timestamp",
								"value": "{{secret-key-timestamp}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/bbps/operators/categories",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"bbps",
								"operators",
								"categories"
							]
						},
						"description": "Get list of all operator categories (Electricity, Water, Gas, etc.)"
					},
					"response": []
				},
				{
					"name": "Get Operator Locations",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "developer_key",
								"value": "{{developer_key}}"
							},
							{
								"key": "secret-key",
								"value": "{{secret-key}}"
							},
							{
								"key": "secret-key-timestamp",
								"value": "{{secret-key-timestamp}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/bbps/operators/locations?category=ELECTRICITY",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"bbps",
								"operators",
								"locations"
							],
							"query": [
								{
									"key": "category",
									"value": "ELECTRICITY",
									"description": "Optional: Filter by category"
								}
							]
						},
						"description": "Get list of locations/states where operators are available"
					},
					"response": []
				},
				{
					"name": "Get Operator List",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "developer_key",
								"value": "{{developer_key}}"
							},
							{
								"key": "secret-key",
								"value": "{{secret-key}}"
							},
							{
								"key": "secret-key-timestamp",
								"value": "{{secret-key-timestamp}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/bbps/operators?category=ELECTRICITY&location=DELHI",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"bbps",
								"operators"
							],
							"query": [
								{
									"key": "category",
									"value": "ELECTRICITY",
									"description": "Optional: Filter by category"
								},
								{
									"key": "location",
									"value": "DELHI",
									"description": "Optional: Filter by location"
								}
							]
						},
						"description": "Get list of operators based on category and/or location"
					},
					"response": []
				},
				{
					"name": "Get Operator Details",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "developer_key",
								"value": "{{developer_key}}"
							},
							{
								"key": "secret-key",
								"value": "{{secret-key}}"
							},
							{
								"key": "secret-key-timestamp",
								"value": "{{secret-key-timestamp}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/bbps/operators/:operatorId",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"bbps",
								"operators",
								":operatorId"
							],
							"variable": [
								{
									"key": "operatorId",
									"value": "OP001",
									"description": "Operator ID from operator list"
								}
							]
						},
						"description": "Get operator details from database"
					},
					"response": []
				},
				{
					"name": "Get Operator Parameters",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "developer_key",
								"value": "{{developer_key}}"
							},
							{
								"key": "secret-key",
								"value": "{{secret-key}}"
							},
							{
								"key": "secret-key-timestamp",
								"value": "{{secret-key-timestamp}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/bbps/operators/:operatorId/parameters",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"bbps",
								"operators",
								":operatorId",
								"parameters"
							],
							"variable": [
								{
									"key": "operatorId",
									"value": "OP001",
									"description": "Operator ID"
								}
							]
						},
						"description": "Get required parameters for fetching bills from this operator"
					},
					"response": []
				}
			],
			"description": "Public APIs - EKO authentication headers required"
		},
		{
			"name": "Bill Operations (Auth Required)",
			"item": [
				{
					"name": "Fetch Bill",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "developer_key",
								"value": "{{developer_key}}"
							},
							{
								"key": "secret-key",
								"value": "{{secret-key}}"
							},
							{
								"key": "secret-key-timestamp",
								"value": "{{secret-key-timestamp}}"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}",
								"description": "JWT token from login"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"operatorId\": \"OP001\",\n  \"parameters\": {\n    \"consumerNumber\": \"1234567890\"\n  },\n  \"idempotencyKey\": \"optional_unique_key_123\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/bbps/fetch",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"bbps",
								"fetch"
							]
						},
						"description": "Fetch bill details from operator. Parameters vary by operator."
					},
					"response": []
				},
				{
					"name": "Pay Bill",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "developer_key",
								"value": "{{developer_key}}"
							},
							{
								"key": "secret-key",
								"value": "{{secret-key}}"
							},
							{
								"key": "secret-key-timestamp",
								"value": "{{secret-key-timestamp}}"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"fetchReferenceId\": \"FR123456789\",\n  \"amount\": 1500.00,\n  \"paymentMethod\": \"WALLET\",\n  \"idempotencyKey\": \"optional_unique_key_456\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/bbps/pay",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"bbps",
								"pay"
							]
						},
						"description": "Pay bill using fetchReferenceId from fetch bill response"
					},
					"response": []
				},
				{
					"name": "Check Payment Status",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "developer_key",
								"value": "{{developer_key}}"
							},
							{
								"key": "secret-key",
								"value": "{{secret-key}}"
							},
							{
								"key": "secret-key-timestamp",
								"value": "{{secret-key-timestamp}}"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/bbps/payments/:transactionId/status",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"bbps",
								"payments",
								":transactionId",
								"status"
							],
							"variable": [
								{
									"key": "transactionId",
									"value": "TXN123456789",
									"description": "EKO transaction ID from pay bill response"
								}
							]
						},
						"description": "Check payment status using EKO transaction ID"
					},
					"response": []
				},
				{
					"name": "Get Payment History",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "developer_key",
								"value": "{{developer_key}}"
							},
							{
								"key": "secret-key",
								"value": "{{secret-key}}"
							},
							{
								"key": "secret-key-timestamp",
								"value": "{{secret-key-timestamp}}"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/bbps/payments?status=SUCCESS&page=1&limit=20",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"bbps",
								"payments"
							],
							"query": [
								{
									"key": "status",
									"value": "SUCCESS",
									"description": "Optional: Filter by status (PENDING, SUCCESS, FAILED)"
								},
								{
									"key": "page",
									"value": "1",
									"description": "Page number"
								},
								{
									"key": "limit",
									"value": "20",
									"description": "Items per page"
								}
							]
						},
						"description": "Get user's payment history with pagination"
					},
					"response": []
				},
				{
					"name": "Get Payment Details",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "developer_key",
								"value": "{{developer_key}}"
							},
							{
								"key": "secret-key",
								"value": "{{secret-key}}"
							},
							{
								"key": "secret-key-timestamp",
								"value": "{{secret-key-timestamp}}"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/bbps/payments/:paymentId",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"bbps",
								"payments",
								":paymentId"
							],
							"variable": [
								{
									"key": "paymentId",
									"value": "507f1f77bcf86cd799439011",
									"description": "MongoDB payment ID"
								}
							]
						},
						"description": "Get detailed payment information"
					},
					"response": []
				},
				{
					"name": "Get Bill Fetch History",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "developer_key",
								"value": "{{developer_key}}"
							},
							{
								"key": "secret-key",
								"value": "{{secret-key}}"
							},
							{
								"key": "secret-key-timestamp",
								"value": "{{secret-key-timestamp}}"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/bbps/fetches?operatorId=OP001&status=SUCCESS&page=1&limit=20",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"bbps",
								"fetches"
							],
							"query": [
								{
									"key": "operatorId",
									"value": "OP001",
									"description": "Optional: Filter by operator"
								},
								{
									"key": "status",
									"value": "SUCCESS",
									"description": "Optional: Filter by status"
								},
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "20"
								}
							]
						},
						"description": "Get bill fetch history with filters"
					},
					"response": []
				}
			],
			"description": "Requires Bearer token authentication + EKO headers"
		},
		{
			"name": "Webhook",
			"item": [
				{
					"name": "EKO Webhook (Callback)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"transactionId\": \"TXN123456789\",\n  \"paymentId\": \"PAY123456789\",\n  \"fetchReferenceId\": \"FR123456789\",\n  \"status\": \"SUCCESS\",\n  \"amount\": 1500.00,\n  \"message\": \"Payment processed successfully\",\n  \"timestamp\": \"2024-01-15T10:30:00Z\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/bbps/webhook/eko",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"bbps",
								"webhook",
								"eko"
							]
						},
						"description": "Webhook endpoint for EKO payment status callbacks. No auth required."
					},
					"response": []
				},
				{
					"name": "Webhook Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/bbps/webhook/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"bbps",
								"webhook",
								"health"
							]
						},
						"description": "Check if webhook endpoint is active"
					},
					"response": []
				}
			],
			"description": "Webhook endpoints for EKO callbacks"
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:3000",
			"type": "string",
			"description": "Your server base URL"
		},
		{
			"key": "auth_token",
			"value": "your_jwt_token_here",
			"type": "string",
			"description": "JWT token from login (for protected endpoints)"
		},
		{
			"key": "developer_key",
			"value": "b6722d770f4d9f4dac1a1d98843fd2ab",
			"type": "string",
			"description": "EKO Developer Key"
		},
		{
			"key": "authenticator_key",
			"value": "5b572cea-769a-4e92-8efc-b1f6e7d99237",
			"type": "string",
			"description": "EKO Authenticator Key (used to generate secret-key)"
		},
		{
			"key": "secret-key",
			"value": "",
			"type": "string",
			"description": "Auto-generated by pre-request script"
		},
		{
			"key": "secret-key-timestamp",
			"value": "",
			"type": "string",
			"description": "Auto-generated by pre-request script"
		}
	]
}
